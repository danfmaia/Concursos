# BACEN - Disciplina 8 - Engenharia de Software (ES)

Prof. Tiago Lage Payne de Pádua

## 8.1. Arquitetura de Sistemas Web

### 8.1.1. Protocolo HTTP

- Def. — Hypertext Transfer Protocol (HTTP) é um _protocolo de camada de aplicação p/ transmissão de documentos hipermídia_, como o HTML.

- Outros protocolos:

  - File Transfer Protocol - FTP
  - Simple Mail Transfer Protocol - SMTP

- Foi desenvolvido p/ _comunicação entre navevagores web e servidores web_, porém tbm pode ser utilizado p/ _outros propósitos_.

- Segue um _modelo cliente-servidor clássico_, onde um cliente abre uma conexão, executa uma requisição e espera até receber uma resposta.

- É tbm um protocolo _sem estado (stateless)_, que significa que o servidor não mantém nenhum dado entre duas requisições (state).

#### Componentes de sistemas baseados em HTTP

- O HTTP é um protocolo **cliente-servidor**: as requisições são enviadas por uma _entidade_, o agente-usuário (ou um proxy em nome dele).

- A maior parte do tempo, o agente-usuário é um navegador da web, mas pode ser qualquer coisa, como por exemplo um robô que varre a web p/ preencher e manter um índice de mecanismo de pesquisa e coletar informações.

- Cada _requisição (request)_ individual é enviada p/ um servidor, que irá lidar com isso e fornecer um resultado, chamado de _resposta (response)_.

- Entre a requisição e a resposta existem várias entidades, designadas coletivamente como _proxies_, que executam operações diferentes e atuam como gateways (intermediários) ou caches, por exemplo.

#### Cliente: o Agente-Usuário

- Def. — O agente-usuário é qualquer ferramenta que _age em nome do usuário_.

- Essa função é predominantemente realizada pelo navegador web.

- O navegador _sempre é a entidade que inicia as requisições_, nunca o lado do servidor.
  > Embora alguns mecanismos tenham sido adicionados ao longo dos anos p/ simular mensagens iniciadas pelo servidor.

#### O Servidor de Páginas Web

- Do outro lado do canal de comunicação está o servidor, que serve o documento requisitado pelo usuário.

- Um servidor se aprenseta virtualmente como uma única máquina.
  > Isto porque o servidor pode ser uma _coleção de servidores dividindo a carga_—através de uma técnica chamada _balanceamento de carga (load balancer)_—ou também como um programa complexo que _acessa outros servidores_ (como um cache, um servidor de banco de dados, servidores e-commerce, etc), gerando todo ou parte do documento solicitado.

#### Proxies

- Entre o navegador web e o servidor, _vários computadores e máquinas transmitem as mensagens HTTP_.

- Devido a estrutura em camadas da pilha web, _a maioria dessas máquinas operam em alguma das camadas_ (de transporte, de rede ou física), sendo _transparentes_ na camada da aplicação HTTP, e potencialmente exercendo um grande impacto na performance.

- Essas _máquinas que operam na camada de aplicação são normalmente conhecidas como proxies_ (ou representantes, ou procuradores).

#### Aspectos básicos do HTTP

- Simples.
- Extensível.
  > Cabeçalhos (headers).
- Não tem estado, mas tem sessões.
  > Cookies.
- HTTP e conexões.
  > O HTTP utiliza apenas o protocolo de conexão TCP, por ser um protocolo confiável. Há tbm o protocolo UDP, que não é confiável e pois casos de uso diferentes.

#### O que pode ser controlado pelo HTTP

- Cache
- Relaxamento das restrições na origem
- Autenticação
  > Basic Authentication. Não é recomendado.
- Proxy e tunelamento
- Sessões
  > Cookies.

#### Fluxo HTTP

1. Abre uma conexão TCP.

   > A conexão TCP será usada p/ enviar uma requisição, ou várias, e receber uma resposta. O cliente pode abrir uma nova conexão, reusar uma conexão existente, ou abrir várias conexões ao servidores.

2. Envia uma mensagem HTTP.

   > Mensagens HTTP antes do HTTP/2.0 são legíveis às pessoas. Com o HTTP/2.0 essas mensagens simples são encapsuladas dentro de quadros (frames), enviabilizando a leitura direta. O princípio, porém, mantém-se o mesmo.

3. Lê a resposta do servidor.

4. Fecha ou reutiliza a conexão p/ requisições futuras.

#### Mensagens HTTP

- Requisição

  - Method
  - Path
  - Versão de protocolo
  - Headers:
    - Host
    - Accept-Language

- Resposta

  - Versão de protocolo
  - Status code
  - Status message
  - Headers

#### APIs baseadas no HTTP

A API mais utilizada construída em cima do HTTP é a XMLHttpRequest, que pode ser usada p/ trocar dados entre um agente-usuário e um servidor.
